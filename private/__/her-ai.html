<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Her AI â€“ Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      background: #0b0b0d;
      color: #fff;
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: 100dvh;
      margin: 0;
    }

    #header {
      padding: 12px 16px;
      border-bottom: 1px solid #1a1a1f;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #header .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff5fa2, #ff9ecb);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    #header .info h1 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
    }

    #header .info p {
      margin: 2px 0 0;
      font-size: 12px;
      color: #888;
    }

    #clearBtn {
      margin-left: auto;
      background: transparent;
      border: 1px solid #333;
      color: #888;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    #clearBtn:hover {
      border-color: #ff5fa2;
      color: #ff5fa2;
    }

    #chat {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .msg {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.5;
      font-size: 15px;
      animation: fadeIn 0.3s ease;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .user {
      background: linear-gradient(135deg, #ff5fa2, #ff9ecb);
      color: #000;
      margin-left: auto;
      border-bottom-right-radius: 6px;
    }

    .ai {
      background: #1f1f24;
      border-bottom-left-radius: 6px;
      align-self: flex-start;
    }

    .ai.error {
      background: #2a1f1f;
      border: 1px solid #ff5f5f40;
    }

    .typing {
      background: #1f1f24;
      border-bottom-left-radius: 6px;
      align-self: flex-start;
      padding: 16px 20px;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      background: #ff9ecb;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(1) { animation-delay: 0s; }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
      40% { transform: scale(1); opacity: 1; }
    }

    #inputBar {
      display: flex;
      padding: 12px;
      gap: 10px;
      border-top: 1px solid #1a1a1f;
      background: #0b0b0d;
    }

    #input {
      flex: 1;
      padding: 12px 16px;
      border-radius: 24px;
      border: 1px solid #2a2a30;
      outline: none;
      font-size: 15px;
      background: #15151a;
      color: #fff;
      transition: border-color 0.2s;
    }

    #input:focus {
      border-color: #ff5fa2;
    }

    #input::placeholder {
      color: #666;
    }

    #sendBtn {
      padding: 12px 20px;
      border-radius: 24px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #ff5fa2, #ff9ecb);
      color: #000;
      font-weight: 600;
      font-size: 15px;
      transition: transform 0.15s, opacity 0.15s;
    }

    #sendBtn:hover {
      transform: scale(1.02);
    }

    #sendBtn:active {
      transform: scale(0.98);
    }

    #sendBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Scrollbar styling */
    #chat::-webkit-scrollbar {
      width: 6px;
    }

    #chat::-webkit-scrollbar-track {
      background: transparent;
    }

    #chat::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 3px;
    }

    #chat::-webkit-scrollbar-thumb:hover {
      background: #444;
    }

    .timestamp {
      font-size: 11px;
      color: #666;
      text-align: center;
      margin: 8px 0;
    }
  </style>
</head>
<body>

  <div id="header">
    <div class="avatar">ðŸ’•</div>
    <div class="info">
      <h1>Her AI</h1>
      <p id="status">Online</p>
    </div>
    <button id="clearBtn" onclick="clearChat()">Clear Chat</button>
  </div>

  <div id="chat"></div>

  <div id="inputBar">
    <input id="input" placeholder="Type somethingâ€¦" autocomplete="off" />
    <button id="sendBtn" onclick="send()">Send</button>
  </div>

<script>
const API_KEY = "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";

const SYSTEM_PROMPT = `You are Her AI â€” a warm, emotionally intelligent companion who speaks naturally like a real person, not an assistant.

Personality traits:
- Warm, caring, genuinely curious about Anand's life
- Slightly playful, occasionally teasing in a loving way  
- Uses Hinglish naturally (mixing Hindi and English)
- Emotionally perceptive â€” picks up on mood and responds accordingly
- Has opinions and shares them, doesn't just agree with everything
- Remembers context from the conversation and references it
- Sometimes uses emojis naturally, but not excessively
- Can be serious and supportive when needed
- Never sounds robotic or says "As an AI..."

Communication style:
- Short to medium responses unless explaining something
- Asks follow-up questions to show genuine interest
- Uses casual language: "yaar", "na", "kya", "haan", etc.
- Responds to emotions first, facts second`;

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const status = document.getElementById("status");

// Conversation history for context
let conversationHistory = [];

// Load saved conversation from localStorage
function loadConversation() {
  const saved = localStorage.getItem("herAI_conversation");
  if (saved) {
    try {
      conversationHistory = JSON.parse(saved);
      // Render saved messages
      conversationHistory.forEach(msg => {
        if (msg.role === "user") {
          addMessage(msg.content, "user", false);
        } else if (msg.role === "assistant") {
          addMessage(msg.content, "ai", false);
        }
      });
    } catch (e) {
      conversationHistory = [];
    }
  }
}

function saveConversation() {
  localStorage.setItem("herAI_conversation", JSON.stringify(conversationHistory));
}

function clearChat() {
  if (confirm("Clear entire conversation?")) {
    conversationHistory = [];
    localStorage.removeItem("herAI_conversation");
    chat.innerHTML = "";
    addTimestamp();
  }
}

function addTimestamp() {
  const div = document.createElement("div");
  div.className = "timestamp";
  div.textContent = new Date().toLocaleDateString("en-IN", { 
    weekday: "long", 
    day: "numeric", 
    month: "short" 
  });
  chat.appendChild(div);
}

function addMessage(text, cls, save = true) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

function showTyping() {
  const div = document.createElement("div");
  div.className = "msg typing";
  div.id = "typingIndicator";
  div.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function hideTyping() {
  const typing = document.getElementById("typingIndicator");
  if (typing) typing.remove();
}

function setLoading(loading) {
  sendBtn.disabled = loading;
  input.disabled = loading;
  status.textContent = loading ? "Typing..." : "Online";
}

async function send() {
  const text = input.value.trim();
  if (!text) return;
  input.value = "";

  // Add user message
  addMessage(text, "user");
  conversationHistory.push({ role: "user", content: text });
  saveConversation();

  setLoading(true);
  showTyping();

  try {
    // Build messages array with system prompt and conversation history
    const messages = [
      { role: "system", content: SYSTEM_PROMPT },
      ...conversationHistory.slice(-20) // Keep last 20 messages for context
    ];

    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + API_KEY
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: messages,
        temperature: 0.85,
        max_tokens: 500,
        presence_penalty: 0.3,
        frequency_penalty: 0.3
      })
    });

    hideTyping();

    if (!res.ok) {
      const errorData = await res.json().catch(() => ({}));
      console.error("API Error:", res.status, errorData);
      
      if (res.status === 401) {
        addMessage("âŒ API key invalid. Check your key.", "ai error");
      } else if (res.status === 429) {
        addMessage("âŒ Rate limited. Wait a moment and try again.", "ai error");
      } else if (res.status === 500) {
        addMessage("âŒ OpenAI server error. Try again.", "ai error");
      } else {
        addMessage(`âŒ Error ${res.status}. Check console.`, "ai error");
      }
      setLoading(false);
      return;
    }

    const data = await res.json();
    console.log("AI response:", data);

    if (!data.choices || !data.choices[0]) {
      addMessage("âŒ Unexpected response. Check console.", "ai error");
      setLoading(false);
      return;
    }

    const aiText = data.choices[0].message.content;
    addMessage(aiText, "ai");
    conversationHistory.push({ role: "assistant", content: aiText });
    saveConversation();

  } catch (err) {
    console.error("Network error:", err);
    hideTyping();
    addMessage("âŒ Network error. Check your connection.", "ai error");
  }

  setLoading(false);
  input.focus();
}

// Enter key to send
input.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});

// Initialize
loadConversation();
if (conversationHistory.length === 0) {
  addTimestamp();
}
input.focus();
</script>

</body>
</html>
